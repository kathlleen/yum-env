{% extends "base_rest.html" %}
{% load static %}

{% block static_css %}
<link rel="stylesheet" href="{% static 'css/rest-edit.css' %}"/>
<style>
    .stat-page {
        max-width: 1000px;
        margin: 40px auto;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(5px);
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        color: white;
    }

    .stat-page h2 {
        text-align: center;
        margin-bottom: 30px;
        font-size: 28px;
        color: #64FF8F;
    }

    .stat-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .stat-block {
        background: rgba(255, 255, 255, 0.07);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .stat-block h4 {
        font-size: 18px;
        margin-bottom: 10px;
    }

    .stat-block p {
        margin: 5px 0;
        color: white;
    }

    table {
        width: 100%;
        margin-top: 20px;
        color: white;
    }

    th, td {
        padding: 8px;
        text-align: left;
    }






</style>
{% endblock %}

{% block content %}

<div class="stat-page">
    <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</h2>

    <div class="stat-grid">
        <div class="stat-block">
            <h4>üçΩ –ó–∞–∫–∞–∑—ã</h4>
            <p>–°–µ–≥–æ–¥–Ω—è: {{ orders_today }}</p>
            <p>–ù–µ–¥–µ–ª—è: {{ orders_week }}</p>
            <p>–ú–µ—Å—è—Ü: {{ orders_month }}</p>
        </div>

        <div class="stat-block">
            <h4>üí∞ –ü—Ä–∏–±—ã–ª—å</h4>
            <p>–°–µ–≥–æ–¥–Ω—è: {{ earned_today }} BYN</p>
            <p>–ù–µ–¥–µ–ª—è: {{ earned_week }} BYN</p>
            <p>–ú–µ—Å—è—Ü: {{ earned_month }} BYN</p>
        </div>

        <div class="stat-block">
            <h4>‚≠ê –†–µ–π—Ç–∏–Ω–≥</h4>
            <p>–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: {{ avg_rating|default:"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö" }}</p>
        </div>

        <div class="stat-block">
            <h4>üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –±–ª—é–¥–∞</h4>
            {% for dish in top_dishes %}
            <p>{{ forloop.counter }}. {{ dish.dish__name }} ‚Äî {{ dish.total_qty }} —à—Ç.</p>
            {% empty %}
            <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>
            {% endfor %}
        </div>

    </div>

    <div class="stat-page">
        <canvas id="ordersChart" width="400" height="200"></canvas>
    </div>
    <div class="stat-page">
        <canvas id="revenueChart" width="400" height="200"></canvas>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const ordersCtx = document.getElementById('ordersChart').getContext('2d');
const ordersChart = new Chart(ordersCtx, {
    type: 'bar',
    data: {
        labels: {{ orders_labels|safe }},
        datasets: [{
            label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –≤ –¥–µ–Ω—å',
            data: {{ orders_data|safe }},
            backgroundColor: '#64FF8F',
            borderColor: '#3CE578',
            borderWidth: 1,
            borderRadius: 5,
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                color: 'white',  // ‚Üê —Ü–≤–µ—Ç –ø–æ–¥–ø–∏—Å–µ–π –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ –æ—Å–∏ Y
            },
                title: { display: true, text: '–ö–æ–ª-–≤–æ –∑–∞–∫–∞–∑–æ–≤', color: 'white', }
            },
            x: {
            ticks: {
                color: 'white',  // ‚Üê —Ü–≤–µ—Ç –ø–æ–¥–ø–∏—Å–µ–π –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ –æ—Å–∏ Y
            },
                title: { display: true, text: '–î–∞—Ç–∞', color: 'white', }
            }
        },
        plugins: {
            legend: {
            labels: {
                color: 'white'  // ‚Üê —Ü–≤–µ—Ç –ª–µ–≥–µ–Ω–¥—ã
            }
        },
            tooltip: { mode: 'index', intersect: false }
        }
    }
});

const revenueCtx = document.getElementById('revenueChart').getContext('2d');
const revenueChart = new Chart(revenueCtx, {
    type: 'line',
    data: {
        labels: {{ orders_labels|safe }},
        datasets: [{
            label: '–í—ã—Ä—É—á–∫–∞ (BYN)',
            data: {{ revenue_data|safe }},
            backgroundColor: 'rgba(255, 255, 255, 0.1)',
            borderColor: '#FFD700',
            borderWidth: 2,
            fill: true,
            tension: 0.3,
            pointBackgroundColor: '#FFD700',
            pointRadius: 4,
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                color: 'white',  // ‚Üê —Ü–≤–µ—Ç –ø–æ–¥–ø–∏—Å–µ–π –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ –æ—Å–∏ Y
            },
                title: { display: true, text: 'BYN –≤ –¥–µ–Ω—å', color: 'white' }
            },
            x: {
            ticks: {
                color: 'white',  // ‚Üê —Ü–≤–µ—Ç –ø–æ–¥–ø–∏—Å–µ–π –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ –æ—Å–∏ Y
            },
                title: { display: true, text: '–î–∞—Ç–∞', color: 'white', }
            }
        },
        plugins: {
            legend: {
            labels: {
                color: 'white'  // ‚Üê —Ü–≤–µ—Ç –ª–µ–≥–µ–Ω–¥—ã
            }
        },
            tooltip: { mode: 'index', intersect: false }
        }
    }
});





</script>
{% endblock %}


